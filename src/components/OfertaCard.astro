---
import type { Oferta } from '../lib/supabase';

interface Props {
  oferta: Oferta;
}

const { oferta } = Astro.props;

// Calcular fecha relativa
const getRelativeTime = (date: string) => {
  const now = new Date();
  const created = new Date(date);
  const diffInMs = now.getTime() - created.getTime();
  const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));

  if (diffInDays === 0) return 'Hoy';
  if (diffInDays === 1) return 'Ayer';
  if (diffInDays < 7) return `Hace ${diffInDays} días`;
  if (diffInDays < 30) return `Hace ${Math.floor(diffInDays / 7)} semanas`;
  return `Hace ${Math.floor(diffInDays / 30)} meses`;
};

const tipoJornadaColor = {
  'Full-time': 'bg-blue-50 text-blue-700',
  'Part-time': 'bg-green-50 text-green-700',
  'Freelance': 'bg-purple-50 text-purple-700',
  'Práctica': 'bg-orange-50 text-orange-700',
};
---

<a
  href={`/oferta/${oferta.id}`}
  class="block bg-white rounded-lg shadow-sm border border-border p-6 hover:shadow-md transition-shadow"
>
  <h3 class="text-xl font-semibold text-text-primary">{oferta.titulo}</h3>
  <p class="text-text-secondary mt-1">{oferta.empresa}</p>

  <div class="flex flex-wrap items-center gap-4 mt-3 text-sm text-text-secondary">
    <span class="flex items-center gap-1">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
      {oferta.comuna}
    </span>

    <span class={`px-2 py-1 rounded text-xs font-medium ${tipoJornadaColor[oferta.tipo_jornada]}`}>
      {oferta.tipo_jornada}
    </span>

    {oferta.categoria && (
      <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs">
        {oferta.categoria}
      </span>
    )}
  </div>

  <p class="text-sm text-gray-400 mt-3">{getRelativeTime(oferta.created_at)}</p>
</a>
